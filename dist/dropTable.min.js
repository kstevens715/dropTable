/*! Drag, Drop & Process data from spreadsheet - v0.1.0 - 2013-04-20
* https://github.com/kstevens715/dropTable
* Copyright (c) 2013 Kyle Stevens; Licensed MIT */
var tableModel={rows:[],columns:[]};(function(a){"use strict";var e,r,t="Badge",n={init:function(t){this.each(function(){var a=e.data("dropTable");a||e.data("dropTable",tableModel)}),r=a.extend({fnProcessRow:null,fnDropComplete:null,delayProcessing:!1,fieldDelimiter:"	",dataFormat:"Text",columnDefinitions:null,firstRowIsHeader:!1},t),this.on("dragover",n.dragOver),this.on("drop",n.drop),this.on("dragenter",n.dragEnter),this.on("dragleave",n.dragLeave),n.renderDropTable()},drop:function(a){if(n.isBadge(a))return!1;var t=a.originalEvent.dataTransfer.getData(r.dataFormat);return e.data("dropTable").rows=n.parseData(t),n.extractHeaders(),r.delayProcessing||o.process(),n.renderTable(),"function"==typeof r.fnDropComplete&&r.fnDropComplete(),!0},dragOver:function(a){return n.isBadge(a)},dragEnter:function(){return!1},dragLeave:function(){return!1},isBadge:function(a){var e=a.originalEvent.dataTransfer.getData(t);return""===e?!1:!0},parseData:function(e){return a.csv.toArrays(e,{separator:r.fieldDelimiter})},extractHeaders:function(){r.firstRowIsHeader&&e.data("dropTable").rows[0].forEach(function(r,t){e.data("dropTable").columns[t]=r.toLowerCase(),a("li span.badge:contains('"+r+"')").parent().remove()})},renderDropTable:function(){var a="<div class='droptable-sidebar'></div><div class='droptable-droparea'><p>Drop Data Here!</p></div>";e.html(a),n.renderSidebar()},renderSidebar:function(){var a='<div><ul class="droptable-columndefinitions unstyled">';for(var t in r.columnDefinitions)a+='<li id="droptable-badge-'+t+'">',a+='<span class="badge" draggable="true" ',a+='ondragstart="',a+="event.dataTransfer.setData('Badge', '"+t+"')\"",a+=">",a+=t,a+="</span></li>";a+="</ul></div>",e.find(".droptable-sidebar").html(a)},applyStyling:function(){},renderTable:function(){var a,r,t,o;t=e.data("dropTable").rows,o=e.data("dropTable").columns,a='<table class="table table-striped table-bordered"><thead>',t[0].forEach(function(e,t){r=o[t],void 0===r?(a+="<th>UNMAPPED</th>",o[t]="UNMAPPED"+t):a+="<th><span class='badge'>"+r+"</span></th>"}),a+="</thead><tbody>",t.slice(1).forEach(function(e){a+="<tr>",e.forEach(function(e){a=a+"<td>"+e+"</td>"}),a+="</tr>"}),a+="</tbody>",a+="</table>",e.find(".droptable-droparea").html(a);var d=e.find("th");d.on("dragover",n.dragOverColumn),d.on("drop",n.mapColumn)},dragOverColumn:function(a){var e=a.originalEvent.dataTransfer.getData(t);return e===t?!0:!1},mapColumn:function(r){var n=r.originalEvent.dataTransfer.getData(t);e.data("dropTable").columns[this.cellIndex]=n.toLowerCase(),a(this).html("<span class='badge'>"+n+"</span>"),a("li span.badge:contains('"+n+"')").parent().remove()}},o={process:function(){var a={};"function"==typeof r.fnProcessRow&&e.data("dropTable").rows.forEach(function(t,n){(!r.firstRowIsHeader||n>0)&&(a.rawData=t,t.forEach(function(r,t){a[e.data("dropTable").columns[t]]=r}),r.fnProcessRow(a,n+1))})}};a.fn.dropTable=function(a){return e=this,o[a]?o[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof a&&a||n.init.apply(this,arguments),this}})(jQuery);